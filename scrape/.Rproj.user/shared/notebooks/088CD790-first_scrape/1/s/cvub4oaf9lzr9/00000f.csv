"0","# Quick check: go to My Books (table view, 100 per page)"
"0","wait_until_logged_in <- function(timeout = 300, poll = 3) {"
"0","  t0 <- Sys.time()"
"0","  repeat {"
"0","    # try going to My Books (if you’re not logged in, it redirects to sign_in)"
"0","    retry_nav(mybooks_url)"
"0","    Sys.sleep(2)"
"0","    "
"0","    # check current URL"
"0","    curr <- try(remDr$getCurrentUrl()[[1]], silent = TRUE)"
"0","    if (!inherits(curr, ""try-error"")) {"
"0","      # if it does NOT contain ""sign_in"", you’re probably logged in"
"0","      not_signin <- !grepl(""sign_in"", curr, fixed = TRUE)"
"0","    } else {"
"0","      not_signin <- FALSE"
"0","    }"
"0","    "
"0","    # check if the page has a table"
"0","    src <- try(remDr$getPageSource()[[1]], silent = TRUE)"
"0","    has_table <- FALSE"
"0","    if (!inherits(src, ""try-error"")) {"
"0","      html <- xml2::read_html(src)"
"0","      has_table <- length(rvest::html_elements(html, ""table"")) > 0"
"0","    }"
"0","    "
"0","    if (isTRUE(not_signin) && isTRUE(has_table)) {"
"0","      message(""✔️ Login detected. Continuing."")"
"0","      break"
"0","    }"
"0","    "
"0","    if (as.numeric(difftime(Sys.time(), t0, units = ""secs"")) > timeout) {"
"0","      stop(""Login was not detected within the expected time ("", timeout, "" s)."")"
"0","    }"
"0","    Sys.sleep(poll)"
"0","  }"
"0","}"
"0",""
"0","wait_until_logged_in(timeout = 300, poll = 3)"
"2","✔️ Login detected. Continuing.
"
"0","Sys.sleep(2)  # small buffer"
"0",""
