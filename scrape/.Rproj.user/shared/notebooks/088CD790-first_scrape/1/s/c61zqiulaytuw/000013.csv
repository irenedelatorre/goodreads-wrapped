"0",""
"0","# check that the scrape worls (it takes a r)"
"0","# purrr::walk(head(df_read$book_url, 3), test_book_metadata)"
"0",""
"0","## ONLY FOR DEBUGGING"
"0","debug_language <- function(book_url) {"
"0","  library(xml2); library(rvest); library(stringr)"
"0",""
"0","  cat(""\nTesting:"", book_url, ""\n"")"
"0",""
"0","  html <- tryCatch(read_html(book_url), error = function(e) NULL)"
"0","  if (is.null(html)) {"
"0","    retry_nav(book_url); Sys.sleep(1)"
"0","    src <- remDr$getPageSource()[[1]]"
"0","    html <- read_html(src)"
"0","    cat(""Used Selenium fallback\n"")"
"0","  }"
"0",""
"0","  n_desc_items <- length(rvest::html_elements("
"0","    html, xpath = ""//dl[contains(@class,'DescList')]//div[contains(@class,'DescListItem')]"""
"0","  ))"
"0","  n_dt <- length(rvest::html_elements(html, xpath = ""//dl[contains(@class,'DescList')]//dt""))"
"0","  cat(""DescList items:"", n_desc_items, ""| dt in DescList:"", n_dt, ""\n"")"
"0",""
"0","  labs <- rvest::html_elements("
"0","    html, xpath = ""//dl[contains(@class,'DescList')]//dt"""
"0","  ) |>"
"0","    rvest::html_text2() |>"
"0","    stringr::str_squish()"
"0","  if (length(labs)) {"
"0","    cat(""Labels under DescList:"", paste(head(labs, 10), collapse = "" | ""), ""\n"")"
"0","  }"
"0",""
"0","  # Quick extraction using the same logic as above, condensed"
"0","  lang_labels <- c(""Language"",""Idioma"",""LÃ­ngua"",""Langue"",""Sprache"",""Lingua"")"
"0","  lang_node <- rvest::html_element("
"0","    html,"
"0","    xpath = paste0("
"0","      ""//dl[contains(@class,'DescList')]//div[contains(@class,'DescListItem')]"","
"0","      ""[.//dt[normalize-space() = '"","
"0","      paste(lang_labels, collapse = ""' or normalize-space() = '""),"
"0","      ""']]"""
"0","    )"
"0","  )"
"0","  if (!is.null(lang_node)) {"
"0","    val <- rvest::html_elements("
"0","      lang_node, xpath = "".//dd//*[(@data-testid='contentContainer') or self::dd]"""
"0","    ) |>"
"0","      rvest::html_text2() |>"
"0","      stringr::str_squish()"
"0","    val <- val[nzchar(val)]"
"0","    cat(""Language value:"", if (length(val)) val[[1]] else ""<none>"", ""\n"")"
"0","  } else {"
"0","    cat(""Language block not found in DescList. Will rely on generic/legacy fallback.\n"")"
"0","  }"
"0",""
"0","  invisible(TRUE)"
"0","}"
"0",""
"0",""
"0",""
"0","test_url <- ""https://www.goodreads.com/book/show/53138095-a-court-of-silver-flames"""
"0","res <- scrape_book_metadata(test_url)"
"0","str(res)"
"1","List"
"1",""
"1"," of "
"1",""
"1","3"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","genres_vec"
"1",""
"1",":"
"1"," chr [1:8] "
"1",""
"1","""Fantasy"" ""Romance"" ""Romantasy"" ""Fiction"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","genres    "
"1",""
"1",":"
"1"," chr "
"1",""
"1","""Fantasy; Romance; Romantasy; Fiction; Fae; Audiobook; Fantasy Romance; ...more"""
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","language  "
"1",""
"1",":"
"1"," chr "
"1",""
"1","""English"""
"1",""
"1","
"
